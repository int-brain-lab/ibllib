

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ONE Reference &mdash; IBL Library  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Accessing data with ONE light" href="one_onelight.html" />
    <link rel="prev" title="ONE advanced queries" href="../notebooks/one_advanced/one_advanced.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> IBL Library
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../01_overview.html">IBL data structure</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Installation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../03_one.html">ONE</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="one_introduction.html">Introduction to ONE</a></li>
<li class="toctree-l2"><a class="reference internal" href="one_credentials.html">Setting up ONE credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/one_basics/one_basics.html">ONE basic commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/one_intro/one_intro.html">ONE Introductory Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/one_advanced/one_advanced.html">ONE advanced queries</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ONE Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#open-neurophysiology-environment">Open Neurophysiology Environment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-the-open-neurophysiology-environment-works">How the open neurophysiology environment works</a></li>
<li class="toctree-l4"><a class="reference internal" href="#standardization">Standardization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#versioning-and-subcollections">Versioning and subcollections</a></li>
<li class="toctree-l4"><a class="reference internal" href="#for-data-sharers">For data sharers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#alf">ALF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#event-series">Event series</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interval-series">Interval series</a></li>
<li class="toctree-l4"><a class="reference internal" href="#continuous-timeseries">Continuous timeseries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#file-types">File types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#relations">Relations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#longer-file-names">Longer file names</a></li>
<li class="toctree-l4"><a class="reference internal" href="#metadata">Metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Versioning and subcollections</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="one_onelight.html">Accessing data with ONE light</a></li>
<li class="toctree-l2"><a class="reference internal" href="one_matlab_installation.html">ONE Matlab Installation Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="one_matlab_tutorial.html">ONE Tutorial Matlab</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../04_datajoint.html">Datajoint</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../05_tutorials.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../06_recipes.html">Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../07_developers.html">Python Modules</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../03_one.html">ONE</a> &raquo;</li>
        
      <li>ONE Reference</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/one_docs/one_reference.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="one-reference">
<h1>ONE Reference<a class="headerlink" href="#one-reference" title="Permalink to this headline">¶</a></h1>
<div class="section" id="open-neurophysiology-environment">
<h2>Open Neurophysiology Environment<a class="headerlink" href="#open-neurophysiology-environment" title="Permalink to this headline">¶</a></h2>
<p>Neurophysiology needs data standardization. A scientist should be able to analyze data collected from multiple labs using a single analysis program, without spending untold hours figuring out new file formats. Substantial efforts have recently been put into developing neurodata file standards, with the most successful being the <a class="reference external" href="https://www.nwb.org/">Neurodata Without Borders</a> (NWB) format. The NWB format has a comprehensive and careful design that allows one to store all data and metadata pertaining to a neurophysiology experiment. Nevertheless, its comprehensive design also means a steep learning curve for potential users, which has limited its adoption.</p>
<div class="section" id="how-the-open-neurophysiology-environment-works">
<h3>How the open neurophysiology environment works<a class="headerlink" href="#how-the-open-neurophysiology-environment-works" title="Permalink to this headline">¶</a></h3>
<p>Here we provide a solution to this problem: a set of four simple functions, that allow users to access and search data from multiple sources. To adopt the standard, data providers can use any format they like - all they need to do is implement these functions to fetch the data from their server and load it into Python or MATLAB. Users can then analyze this data with the same exact code as data from any other provider. The learning curve will be simple, and the loader functions would be enough for around 90% of common use cases.</p>
<p>By a <em>data provider</em> we mean an organization that hosts a set of neurophysiology data on an internet server (for example, the <a class="reference external" href="https://www.internationalbrainlab.com/">International Brain Lab</a>). The Open Neurophysiology Environment (ONE) provides a way for scientists to analyze data from multiple data providers using the same analysis code. There is no need for the scientist to explicitly download data files or understand their format - this is all handled seamlessly by the ONE framework. The ONE protocol can also be used to access a scientist’s own experiments stored on their personal computer, but we do not describe this use-case here.</p>
<p>When a user wants to analyze data released by a provider, they first import that provider’s loader functions. In python, to analyze IBL data, they would type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">oneibl.one</span> <span class="kn">import</span> <span class="n">ONE</span>
</pre></div>
</div>
<p>Because it is up to data providers to maintain the loader functions, all a user needs to do to work with data from a specific provider is import their loader module. To analyze Allen data, they could instead type <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">one_allen</span></code>. After that, all other analysis code will be the same, regardless of which provider’s data they are analyzing.</p>
<p>Every experiment a data provider releases is identified by an <em>experiment ID</em> (eID) – a small token that uniquely identifies a particular experiment. It is up to the data provider to specify the format of their eIDs.</p>
<div class="section" id="loading-data">
<h4>Loading data<a class="headerlink" href="#loading-data" title="Permalink to this headline">¶</a></h4>
<p>If a user already knows the eID of an experiment they are interested in, they can load data for the experiment using a command like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">st</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">cbl</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">eID</span><span class="p">,</span> <span class="n">dataset_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;spikes.times&#39;</span><span class="p">,</span> <span class="s1">&#39;spikes.clusters&#39;</span><span class="p">,</span> <span class="s1">&#39;clusters.brain_location&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>This command will download three datasets containing the times and cluster assignments of all spikes recorded in that experiment, together with an estimate of the brain location of each cluster. (In practice, the data will be cached on the user’s local machine so it can be loaded repeatedly with only one download.)</p>
<p>Many neural data signals are time series, and synchronizing these signals is often challenging. ONE will provide a function to interpolate any required timeseries to an evenly or unevenly-sampled timescale of the user’s choice. For example the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hxy</span><span class="p">,</span> <span class="n">hth</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span><span class="o">.</span><span class="n">loadTS</span><span class="p">(</span><span class="n">eID</span><span class="p">,</span> <span class="n">dataset_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;headTracking.xyPos&#39;</span><span class="p">,</span> <span class="s1">&#39;lfp.raw&#39;</span><span class="p">],</span> <span class="n">sample_rate</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>would interpolate head position and lfp to a common 1000 Hz sampling rate. The sample times are returned as <code class="docutils literal notranslate"><span class="pre">t</span></code>.</p>
</div>
<div class="section" id="searching-for-experiments">
<h4>Searching for experiments<a class="headerlink" href="#searching-for-experiments" title="Permalink to this headline">¶</a></h4>
<p>Finally, a user needs to be able to search the data released by a provider, to obtain the eIDs of experiments they want to analyze. To do so they would run a command like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">eIDs</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">lab</span><span class="o">=</span><span class="s1">&#39;CortexLabUCL&#39;</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;hercules&#39;</span><span class="p">,</span> <span class="n">dataset_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;spikes.times&#39;</span><span class="p">,</span> <span class="s1">&#39;spikes.clusters&#39;</span><span class="p">,</span><span class="s1">&#39;headTracking.xyPos&#39;</span><span class="p">])</span>
<span class="n">eIDs</span><span class="p">,</span> <span class="n">eInfo</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">details</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lab</span><span class="o">=</span><span class="s1">&#39;CortexLabUCL&#39;</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;hercules&#39;</span><span class="p">,</span> <span class="n">dataset_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;spikes.times&#39;</span><span class="p">,</span> <span class="s1">&#39;spikes.clusters&#39;</span><span class="p">,</span><span class="s1">&#39;headTracking.xyPos&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>This would find the eIDs for all experiments collected in the specified lab for the specified experimental subject, for which all of the required data is present. There will be more metadata options to refine the search (e.g. dates, genotypes, experimenter), and additional metadata on each matching experiment is returned in <code class="docutils literal notranslate"><span class="pre">eInfo</span></code>. However, the existence of dataset types is normally enough to find the data you want. For example, if you want to analyze electrophysiology in a particular behavior task, the experiments you want are exactly those with datasets describing the ephys recordings and that task’s parameters.</p>
</div>
</div>
<div class="section" id="standardization">
<h3>Standardization<a class="headerlink" href="#standardization" title="Permalink to this headline">¶</a></h3>
<p>The key to ONE’s standardization is the concept of a “standard dataset type”. When a user requests one of these (such as <code class="docutils literal notranslate"><span class="pre">'spikes.times'</span></code>), they are guaranteed that each data provider will return them the same information, organized in the same way - in this case, the times of all extracellularly recorded spikes, measured in seconds relative to experiment start, and returned as a 1-dimensional column vector. It is guaranteed that any dataset types of the form <code class="docutils literal notranslate"><span class="pre">*.times</span></code> or <code class="docutils literal notranslate"><span class="pre">*.*_times</span></code> will be measured in seconds relative to experiment start. Furthermore, all dataset types differing only in their last word (e.g. <code class="docutils literal notranslate"><span class="pre">spikes.times</span></code> and <code class="docutils literal notranslate"><span class="pre">spikes.clusters</span></code>) will have the same number of rows, describing multiple attributes of the same objects. Finally, words matching across dataset types encode references: for example, <code class="docutils literal notranslate"><span class="pre">spikes.clusters</span></code> is guaranteed to contain integers, and to find the brain location of each of these one looks to the corresponding row of <code class="docutils literal notranslate"><span class="pre">clusters.brain_location</span></code>, counting from 0.</p>
<p>Not all data can be standardized, since each project will do unique experiments. Data providers can thereform add their own project-specific dataset types. The list of standard dataset types will be maintained centrally, and will start small but increase over time as the community converges on good ways to standardize more information. It is therefore important to distinguish dataset types agreed as universal standards from types specific to individual projects. To achieve this, names beginning with an underscore are guaranteed never to be standard. It is recommended that nonstandard names identify the group that produces them: for example the dataset types <code class="docutils literal notranslate"><span class="pre">_ibl_trials.stimulusContrast</span></code> and <code class="docutils literal notranslate"><span class="pre">clusters._ibl_task_modulation</span></code> could contain information specific to the IBL project.</p>
</div>
<div class="section" id="versioning-and-subcollections">
<h3>Versioning and subcollections<a class="headerlink" href="#versioning-and-subcollections" title="Permalink to this headline">¶</a></h3>
<p>Data are often released in multiple versions. Most users will want always to have the latest version, but sometimes a user working will want to continue working with a historical version even after it has been updated, to maintain consistency with previous work. To enable versioning, the ONE functions will have accept an optional argument of the form <code class="docutils literal notranslate"><span class="pre">version='v1'</span></code>, which will ensure this specific version is loaded. If the argument is not passed, the latest version will be loaded.</p>
<p>Sometimes the data will contain multiple measurements of the same type, for example if recordings are made with multiple recording probes simultaneously. In these cases, the dataset types for probe 0 will have names like <code class="docutils literal notranslate"><span class="pre">probe00/spikes.times</span></code>, <code class="docutils literal notranslate"><span class="pre">probe00/spikes.clusters</span></code>, and <code class="docutils literal notranslate"><span class="pre">probe00/clusters.brain_location</span></code>; data for probe 1 will be <code class="docutils literal notranslate"><span class="pre">probe01/spikes.times</span></code>, etc. Encoding of references works within a subcollection: i.e. the entries of <code class="docutils literal notranslate"><span class="pre">probe00/spikes.clusters</span></code> point to the rows of <code class="docutils literal notranslate"><span class="pre">probe00/clusters.brain_location</span></code>, starting from 0, and independently of any datasets starting with <code class="docutils literal notranslate"><span class="pre">probe01/</span></code>.</p>
</div>
<div class="section" id="for-data-sharers">
<h3>For data sharers<a class="headerlink" href="#for-data-sharers" title="Permalink to this headline">¶</a></h3>
<p>Data standards are only adopted when they are easy to use, for both providers and users of data. For users, the three ONE functions will be simple to learn, and will cover most common use cases.</p>
<p>For providers, a key advantage of this framework is its low barrier to entry. To share data with ONE, providers do not need to run and maintain a backend server, just to upload their data to a website. We provide a “ONE light” implementation of the ONE loader functions that searches, downloads and caches files from a web server. This will allow producers who do not have in-house computational staff two simple paths to achieve ONE compatibility. The first is to place the data in a directory, using a standard file-naming convention described below, in standard formats including <code class="docutils literal notranslate"><span class="pre">npy</span></code>, <code class="docutils literal notranslate"><span class="pre">csv</span></code>, <code class="docutils literal notranslate"><span class="pre">json</span></code>, and <code class="docutils literal notranslate"><span class="pre">tiff</span></code>. Next, the user runs a program in this directory, which uploads the files to a website or to figshare. Users can then access this data using ONE light. And example of ONE light data is <a class="reference external" href="https://figshare.com/articles/Test1/9917741">here</a>. The ONE light code is <a class="reference external" href="https://github.com/int-brain-lab/ibllib/tree/onelight/oneibl#one-light">here</a>.</p>
</div>
</div>
<div class="section" id="alf">
<h2>ALF<a class="headerlink" href="#alf" title="Permalink to this headline">¶</a></h2>
<p>ALF stands for “ALyx Files”. It not a format but rather a format-neutral file-naming convention. ALF is how IBL organizes files that will be loaded via the ONE protocol.</p>
<p>In ALF, the measurements in an experiment are represented by collections of files in a directory. Each filename has three parts, for example <code class="docutils literal notranslate"><span class="pre">spikes.times.npy</span></code> or <code class="docutils literal notranslate"><span class="pre">spikes.clusters.npy</span></code>. The first two correspond to the ONE dataset type, and we refer to them as the <em>object</em> and the <em>attribute</em>. The third part of the filename, the <em>extension</em>, specifies what physical format the file is in - we primarily use .npy and .tsv but you could use any format, for example video or json .</p>
<p>Each file contains information about particular attribute of the object. For example <code class="docutils literal notranslate"><span class="pre">spikes.times.npy</span></code> indicates the times of spikes and <code class="docutils literal notranslate"><span class="pre">spikes.clusters.npy</span></code> indicates their cluster assignments. You could have another file <code class="docutils literal notranslate"><span class="pre">spikes.amplitudes.npy</span></code> to convey their amplitudes. The important thing is that every file describing an object has the same number of rows (i.e. the 1st dimension of an npy file, number of frames in a video file, etc).  You can therefore think of the files for an object as together defining a table, with column headings given by the attribute in the file names, and values given by the file contents.</p>
<p>ALF objects can represent anything. But three types of object are special:</p>
<div class="section" id="event-series">
<h3>Event series<a class="headerlink" href="#event-series" title="Permalink to this headline">¶</a></h3>
<p>If there is a file with attribute <code class="docutils literal notranslate"><span class="pre">times</span></code>, (i.e. filename <code class="docutils literal notranslate"><span class="pre">obj.times.ext</span></code>), it indicates that this object is an event series. The <code class="docutils literal notranslate"><span class="pre">times</span></code> file contains a numerical array containing times of the events in seconds, relative to a universal timescale common to all files. Other attributes of the events are stored in different files. If you want to represent times relative to another timescale, do this by appending to <code class="docutils literal notranslate"><span class="pre">timescale</span></code> after an underscore (e.g. <code class="docutils literal notranslate"><span class="pre">spikes.times_ephysClock.npy</span></code>). By convention, any other file with attribute that ends in <code class="docutils literal notranslate"><span class="pre">_times</span></code> is understood to be a time in universal seconds; for example <code class="docutils literal notranslate"><span class="pre">trials.reward_times.npy</span></code>. An attribute ending with <code class="docutils literal notranslate"><span class="pre">_times_timescale</span></code> is by convention a time in that timescale.</p>
</div>
<div class="section" id="interval-series">
<h3>Interval series<a class="headerlink" href="#interval-series" title="Permalink to this headline">¶</a></h3>
<p>If there is a file with attribute <code class="docutils literal notranslate"><span class="pre">intervals</span></code>, (i.e. filename <code class="docutils literal notranslate"><span class="pre">tones.intervals.npy</span></code>), it should have two columns, indicating the start and end times of each interval relative to the universal timescale. Again, other attributes of the events can be stored in different files (e.g. <code class="docutils literal notranslate"><span class="pre">tones.frequencies.npy</span></code>. Event times relative to other timescales can be represented by a file with attribute <code class="docutils literal notranslate"><span class="pre">intervals_timescale</span></code>. Again, any other attributes of the form <code class="docutils literal notranslate"><span class="pre">trials.cue_intervals.npy</span></code> are by convention measured in universal seconds.</p>
</div>
<div class="section" id="continuous-timeseries">
<h3>Continuous timeseries<a class="headerlink" href="#continuous-timeseries" title="Permalink to this headline">¶</a></h3>
<p>If there is a file with attribute <code class="docutils literal notranslate"><span class="pre">timestamps</span></code>, it indicates the object is a continuous timeseries. The timestamps file represents information required to synchronize the timeseries to the universal timebase, even if they were unevenly sampled. There are 2 possibilities:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">timestamps</span></code> file contains a single column containing time of every sample within the timescale.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">timestamps</span></code> file contains two rows. Each row of the <code class="docutils literal notranslate"><span class="pre">timestamps</span></code> file represents a synchronization point, with the first column giving the sample number (counting from 0), and the second column giving the corresponding time in universal seconds. The times corresponding to all samples are then found by linear interpolation. Note that the <code class="docutils literal notranslate"><span class="pre">timestamps</span></code> file is an exception to the rule that all files representing a continuous timeseries object must have one row per sample, as it will often have substantially less. Note that an evenly-sampled recording should have just two timestamps, giving the times of the first and last sample.</p></li>
</ul>
</div>
<div class="section" id="file-types">
<h3>File types<a class="headerlink" href="#file-types" title="Permalink to this headline">¶</a></h3>
<p>ALF can deal with any sort of file, as long as it has a concept of a number of rows (or primary dimension). The type of file is recognized by its extension. Preferred choices:</p>
<p>.npy: numpy array file. This is recommended over flat binary since datatype and shape is stored in the file. If you want to name the columns, use a metadata file. If you have an array of 3 or more dimensions, the first dimension counts as the number of rows. To access npy files from MATLAB use <a class="reference external" href="https://github.com/kwikteam/npy-matlab">this</a>.</p>
<p>.tsv: tab-delimited text file. This is recommended over comma-separated files since text fields often have commas in. All rows should have the same number of columns. The first row contains tab-separated names for each column.</p>
<p>.bin: flat binary file. It’s better to use .npy for storing binary dat,a but some recording systems save in flat binary. Rather than convert them, you can ALFize a flat binary file by adding a metadata file, which specifies the number of columns (as the size of the “columns” array) and the binary datatype as a top-level key “dtype”, using numpy naming conventions.</p>
</div>
<div class="section" id="relations">
<h3>Relations<a class="headerlink" href="#relations" title="Permalink to this headline">¶</a></h3>
<p>Encoding of relations between objects can be achieved by a simplified relational model. If the attribute name of one file matches the object name of a second, then the first file is guaranteed to contain integers referring to the rows of the second. For example, <code class="docutils literal notranslate"><span class="pre">spikes.clusters.npy</span></code> would contain integer references to the rows of <code class="docutils literal notranslate"><span class="pre">clusters.brain_location.json</span></code> and <code class="docutils literal notranslate"><span class="pre">clusters.probes.npy</span></code>; and <code class="docutils literal notranslate"><span class="pre">clusters.probes.npy</span></code> would contain integer references to <code class="docutils literal notranslate"><span class="pre">probes.insertion.json</span></code>. Be careful of plurals (<code class="docutils literal notranslate"><span class="pre">clusters.probe.npy</span></code> would not correspond to <code class="docutils literal notranslate"><span class="pre">probes.insertion.json</span></code>) and remember we count arrays starting from 0.</p>
</div>
<div class="section" id="longer-file-names">
<h3>Longer file names<a class="headerlink" href="#longer-file-names" title="Permalink to this headline">¶</a></h3>
<p>A proposed extension to ALF would allow encoding of additional information in filenames with more than 3 parts. In this proposal, file names could have as many parts as you like: object.attribute.x1.x2. … .xN.extension. The extra name parts play no formal role in the ALF conventions, but can serve several additional purposes. For example, if you want unique file names to make archiving and backups easier, they could contain a unique string, for example a Dataset ID from Alyx, or the md5 hash of the file. Extra parts could be used  to encode the subject name if you are worried about accidentally moving files between directories. The filenames might get long; however the important information in the filename is in the first two parts, which users can tab-autocomplete when typing them at the command line; also, because the extension is last, they can also double-click the file to open it with a default application such as a movie viewer.</p>
<p>Finally, if there are multiple files with the same object, attribute, and extensions but different extra parts, these should be treated as files to be concatenated, for example to allow multiple-part tif files as produced by scanimage to be encoded in ALF. The concatenation would happen in hierarchical lexicographical order: i.e. by lexicographic order of x1, then x2 if x1 is equal, etc.</p>
</div>
<div class="section" id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you will want to provide metadata on the columns or rows of a data file. For example, clusters.ccf_location.tsv could be a 4-column tab-delimited text file in which the first 3 columns contain xyz coordinates of a cluster and the 4th contains its inferred brain location as text. In this case, an additional JSON file clusters.ccf_location.metadata.json can provide information about the columns and rows. The metadata file can contain anything, but if it has a top-level key “columns”, that should be an array of size the number of columns, and if it has a top-level key “rows” that should be an array of size the number of rows. If the entries in the columns and rows arrays have a key “name” that defines a name for the column or row; a key “unit” defines a unit of measurement. You can add anything else you want.</p>
<p>Note that in ALF you should not have generally two data files with the same object and attribute: if you have tones.frequencies.npy, you can’t also  have tones.frequencies.tsv. Metadata files are an exception to this: if you have tones.frequencies.npy, you can also have tones.frequencies.metadata.json.</p>
</div>
<div class="section" id="id1">
<h3>Versioning and subcollections<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Versioning and subcollections are achieved with subdirectories. If your main ALF directory contains a subfolder <code class="docutils literal notranslate"><span class="pre">v1</span></code>, any files in there are assumed to be version <code class="docutils literal notranslate"><span class="pre">v1</span></code>. The root directory is assumed to contain the most recent files.</p>
<p>Subcollections are also achieved with subdirectories: a subfolder <code class="docutils literal notranslate"><span class="pre">probe00</span></code> of the main ALF directory contains the files specific to probe 0; you can also have a subcollection within a version such as <code class="docutils literal notranslate"><span class="pre">v1/probe00</span></code>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="one_onelight.html" class="btn btn-neutral float-right" title="Accessing data with ONE light" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../notebooks/one_advanced/one_advanced.html" class="btn btn-neutral float-left" title="ONE advanced queries" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, International Brain Laboratory

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>